<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>packlisteR</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background: #121212;
      color: #f0f0f0;
      max-width: 600px;
      margin: auto;
    }
    .group {
      margin-bottom: 1rem;
      border: 1px solid #333;
      border-radius: 8px;
      background: #1e1e1e;
    }
    .group-header {
      background: #2a2a2a;
      padding: 0.25rem 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 4px;
    }
    .group-items {
      padding: 0.5rem 1rem;
      display: none;
    }
    .group.open .group-items {
      display: block;
    }
    .item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.5rem 0;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }
    label {
      cursor: pointer;
    }
    .buttons {
      margin-top: 2rem;
      display: flex;
      gap: 1rem;
    }
    button {
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>üé• packlisteR</h1>
  <div id="container"></div>
  <div class="buttons">
    <button onclick="generatePDF()">üìÑ Create PDF</button>
    <button onclick="window.print()">üñ®Ô∏è Print</button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    async function loadPackliste() {
      const res = await fetch('packliste.json');
      const data = await res.json();
      const container = document.getElementById('container');
      data.forEach((entry, index) => {
        if (entry.type === 'single') {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'item';
          const id = `single-${index}`;
          const cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.id = id;
          cb.checked = entry.checked;
          const label = document.createElement('label');
          label.setAttribute('for', id);
          label.textContent = entry.label;
          itemDiv.append(cb, label);
          container.appendChild(itemDiv);
        } else {
          const groupEl = document.createElement('div');
          groupEl.className = 'group';
          const gid = `group-${index}`;
          const header = document.createElement('div');
          header.className = 'group-header';
          const gcb = document.createElement('input');
          gcb.type = 'checkbox';
          gcb.id = gid;
          gcb.checked = entry.checked;
          const glabel = document.createElement('label');
          glabel.setAttribute('for', gid);
          glabel.textContent = entry.title;
          header.append(gcb, glabel);
          const itemsContainer = document.createElement('div');
          itemsContainer.className = 'group-items';
          entry.items.forEach((item, i) => {
            const div = document.createElement('div');
            div.className = 'item';
            const iid = `${gid}-item-${i}`;
            const icb = document.createElement('input');
            icb.type = 'checkbox';
            icb.id = iid;
            icb.checked = item.checked;
            icb.disabled = !entry.checked;
            const ilabel = document.createElement('label');
            ilabel.setAttribute('for', iid);
            ilabel.textContent = item.label;
            div.append(icb, ilabel);
            itemsContainer.appendChild(div);
          });
          gcb.addEventListener('change', () => {
            const open = gcb.checked;
            groupEl.classList.toggle('open', open);
            itemsContainer.style.display = open ? 'block' : 'none';
            itemsContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
              cb.disabled = !open;
              cb.checked = false;
            });
          });
          groupEl.append(header, itemsContainer);
          container.appendChild(groupEl);
        }
      });
    }
    function generatePDF() {
      const selected = [];
      document.querySelectorAll('#container .item').forEach(div => {
        const cb = div.querySelector('input[type="checkbox"]');
        if (cb.checked) selected.push(div.querySelector('label').textContent);
      });
      const pdfEl = document.createElement('div');
      const title = document.createElement('h1');
      title.textContent = document.querySelector('h1').textContent;
      pdfEl.appendChild(title);
      const ul = document.createElement('ul');
      selected.forEach(text => {
        const li = document.createElement('li');
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        li.append(cb, document.createTextNode(' ' + text));
        ul.appendChild(li);
      });
      pdfEl.appendChild(ul);
      html2pdf().from(pdfEl).save('Packliste.pdf');
    }
    loadPackliste();
  </script>
</body>
</html>
